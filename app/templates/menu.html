<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Transportima - Menu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" />
    <style>
      :root {
        --primary: #8a48f4;
        --accent: #ffb712;
        --bg: #121212;
        --text: #ffffff;
        --textf: #000000;
        --card: #1f1f1f;
      }

      body {
        background-color: var(--bg);
        color: var(--text);
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
      }

      .navbar {
        background-color: var(--primary);
        padding: 1rem;
      }

      .navbar-brand img {
        height: 40px;
      }

      .nav-link {
        color: #fff;
        margin: 0 1rem;
        font-weight: 500;
      }

      .nav-link:hover,
      .nav-link.active {
        color: var(--accent);
      }

      .container-form {
        margin: 4rem auto 2rem;
        max-width: 700px;
        background: var(--card);
        padding: 2rem;
        border-radius: 10px;
      }

      .form-label {
        margin-bottom: 0.5rem;
        font-weight: 500;
      }

      /* Custom Dropdown Styles */
      .custom-dropdown {
        position: relative;
        margin-bottom: 1rem;
      }

      .dropdown-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: white;
        color: var(--textf);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .dropdown-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(138, 72, 244, 0.2);
      }

      .dropdown-arrow {
        font-size: 12px;
        color: #666;
        transition: transform 0.3s ease;
      }

      .dropdown-arrow.open {
        transform: rotate(180deg);
      }

      .dropdown-list {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ccc;
        border-top: none;
        border-radius: 0 0 8px 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
      }

      .dropdown-list.show {
        display: block;
      }

      .dropdown-item {
        padding: 0.75rem;
        color: var(--textf);
        cursor: pointer;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s ease;
      }

      .dropdown-item:hover {
        background-color: var(--accent);
        color: #000;
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }

      .dropdown-item.filtered {
        display: none;
      }

      .search-input {
        width: 100%;
        padding: 0.5rem;
        border: none;
        border-bottom: 1px solid #eee;
        background: #f8f9fa;
        color: var(--textf);
      }

      .search-input:focus {
        outline: none;
        border-bottom-color: var(--primary);
      }

      .btn-custom {
        background: var(--primary);
        border: none;
        color: white;
        padding: 10px 25px;
        border-radius: 20px;
        display: block;
        width: 100%;
      }

      .btn-custom:hover {
        background: var(--accent);
        color: #000;
      }

      .results {
        margin: 3rem auto;
        max-width: 1000px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 2rem;
      }

      .card-mode {
        background: var(--card);
        border: none;
        border-radius: 10px;
        width: 240px;
        padding: 1.5rem;
        text-align: center;
      }

      .card-mode img {
        width: 60px;
        margin-bottom: 1rem;
      }

      #route_path {
        font-weight: 600;
        margin: 2rem auto;
        text-align: center;
      }

      footer {
        background: var(--primary);
        color: white;
        padding: 1rem;
        text-align: center;
        margin-top: 2rem;
      }

      /* Modal Styles */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 999;
      }

      .overlay.active {
        opacity: 1;
        pointer-events: auto;
      }

      .modal-box {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        background-color: var(--card);
        color: var(--text);
        padding: 2rem;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: all 0.3s ease;
      }

      .modal-box.active {
        opacity: 1;
        pointer-events: auto;
        transform: translate(-50%, -50%) scale(1);
      }

      .modal-box h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .modal-box ol {
        padding-left: 1rem;
      }

      .modal-box .buttons {
        text-align: center;
        margin-top: 1.5rem;
      }

      .modal-box .close-btn {
        padding: 0.5rem 1rem;
        border: none;
        background: var(--accent);
        color: black;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('index') }}">
      <img src="{{ url_for('static', filename='assets/TransportimaP.png') }}" alt="Logo" />
    </a>
    <ul class="navbar-nav ms-auto">
      <li class="nav-item">
        <a class="nav-link {% if request.path == '/home' %}active{% endif %}" href="{{ url_for('home') }}">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if request.path == '/menu' %}active{% endif %}" href="{{ url_for('menu') }}">Menu</a>
      </li>
    </ul>
  </div>
</nav>

    <!-- Modal Box -->
    <section id="modalBox">
      <span class="overlay"></span>
      <div class="modal-box">
        <h2>Attention</h2>
        <h3>
          <ol>
            <li>Make sure you have a destination in a regional city of Central Java Province</li>
            <li>Specify your initial destination by selecting an available city</li>
            <li>Specify your final destination by selecting an available city</li>
            <li>Press the submit button</li>
            <li>The distance will appear in the box of each transportation mode</li>
            <li>ENJOY YOUR TRIP</li>
          </ol>
        </h3>
        <div class="buttons">
          <button class="close-btn">Close</button>
        </div>
      </div>
    </section>

    <section class="container-form">
      <button type="button" class="btn btn-secondary mb-3" onclick="showModal()">Show Info</button>
      <form onsubmit="process(event)">
        <div class="mb-3">
          <label for="startCity" class="form-label">Start City</label>
          <div class="custom-dropdown">
            <div class="dropdown-input" onclick="toggleDropdown('startCity')">
              <span id="startCitySelected">Select Start City</span>
              <span class="dropdown-arrow">▼</span>
            </div>
            <div class="dropdown-list" id="startCityDropdown">
              <input type="text" class="search-input" placeholder="Search cities..." onkeyup="filterCities('startCity', this.value)">
              <div class="dropdown-items" id="startCityItems"></div>
            </div>
          </div>
        </div>
        
        <div class="mb-3">
          <label for="finishCity" class="form-label">Finish City</label>
          <div class="custom-dropdown">
            <div class="dropdown-input" onclick="toggleDropdown('finishCity')">
              <span id="finishCitySelected">Select Finish City</span>
              <span class="dropdown-arrow">▼</span>
            </div>
            <div class="dropdown-list" id="finishCityDropdown">
              <input type="text" class="search-input" placeholder="Search cities..." onkeyup="filterCities('finishCity', this.value)">
              <div class="dropdown-items" id="finishCityItems"></div>
            </div>
          </div>
        </div>
        
        <button type="submit" class="btn btn-custom">Find Route</button>
      </form>
    </section>

    <section class="results">
      <div class="card-mode">
        <img src="{{ url_for('static', filename='assets/iconmotor1.png') }}" alt="Motorcycle" />
        <h5>Motorcycle</h5>
        <p id="motorcycle">... KM</p>
      </div>
      <div class="card-mode">
        <img src="{{ url_for('static', filename='assets/iconcar.png') }}" alt="Car" />
        <h5>Car</h5>
        <p id="car">... KM</p>
      </div>
      <div class="card-mode">
        <img src="{{ url_for('static', filename='assets/icontrain.png') }}" alt="Train" />
        <h5>Train</h5>
        <p id="train">... KM</p>
      </div>
    </section>

    <div id="route_path">Route: ...</div>

    <section class="city-list">
      <div class="container">
        <h5 class="text-center mb-4">Available Cities in Central Java</h5>
        <div class="row row-cols-1 row-cols-md-3 g-3" id="cityListDisplay">
          <!-- Cities will be populated by JavaScript -->
        </div>
      </div>
    </section>

    <footer>
      <img src="{{ url_for('static', filename='assets/TransportimaP.png') }}" height="30" />
      <p class="mt-2">&copy; 2025 Transportima</p>
    </footer>

    <script>
      // Daftar kota-kota di Jawa Tengah
      const cities = [
        'Wonogiri', 'Sukoharjo', 'Karanganyar', 'Klaten', 'Boyolali', 'Surakarta',
        'Sragen', 'Grobogan', 'Semarang', 'Kota Semarang', 'Demak', 'Kudus',
        'Pati', 'Blora', 'Rembang', 'Jepara', 'Magelang', 'Kota Magelang',
        'Temanggung', 'Kendal', 'Kota Salatiga', 'Purworejo', 'Wonosobo', 'Batang',
        'Banjarnegara', 'Pekalongan', 'Kota Pekalongan', 'Kebumen', 'Cilacap',
        'Banyumas', 'Purbalingga', 'Brebes', 'Tegal', 'Kota Tegal', 'Pemalang'
      ];

      let selectedStartCity = '';
      let selectedFinishCity = '';

      // Populate dropdown items
      function populateDropdowns() {
        const startCityItems = document.getElementById('startCityItems');
        const finishCityItems = document.getElementById('finishCityItems');
        
        cities.forEach(city => {
          // Start City Items
          const startItem = document.createElement('div');
          startItem.className = 'dropdown-item';
          startItem.textContent = city;
          startItem.onclick = () => selectCity('startCity', city);
          startCityItems.appendChild(startItem);
          
          // Finish City Items
          const finishItem = document.createElement('div');
          finishItem.className = 'dropdown-item';
          finishItem.textContent = city;
          finishItem.onclick = () => selectCity('finishCity', city);
          finishCityItems.appendChild(finishItem);
        });
        
        // Populate city list display
        const cityListDisplay = document.getElementById('cityListDisplay');
        cities.forEach(city => {
          const col = document.createElement('div');
          col.className = 'col';
          col.innerHTML = `
            <div class="p-2 ps-3 rounded bg-dark bg-opacity-10">
              <span>•</span> ${city}
            </div>
          `;
          cityListDisplay.appendChild(col);
        });
      }

      function toggleDropdown(type) {
        const dropdown = document.getElementById(type + 'Dropdown');
        const arrow = dropdown.previousElementSibling.querySelector('.dropdown-arrow');
        
        // Close other dropdown
        const otherType = type === 'startCity' ? 'finishCity' : 'startCity';
        const otherDropdown = document.getElementById(otherType + 'Dropdown');
        const otherArrow = otherDropdown.previousElementSibling.querySelector('.dropdown-arrow');
        
        otherDropdown.classList.remove('show');
        otherArrow.classList.remove('open');
        
        // Toggle current dropdown
        dropdown.classList.toggle('show');
        arrow.classList.toggle('open');
        
        // Clear search
        const searchInput = dropdown.querySelector('.search-input');
        searchInput.value = '';
        filterCities(type, '');
      }

      function selectCity(type, city) {
        if (type === 'startCity') {
          selectedStartCity = city;
          document.getElementById('startCitySelected').textContent = city;
        } else {
          selectedFinishCity = city;
          document.getElementById('finishCitySelected').textContent = city;
        }
        
        // Close dropdown
        const dropdown = document.getElementById(type + 'Dropdown');
        const arrow = dropdown.previousElementSibling.querySelector('.dropdown-arrow');
        dropdown.classList.remove('show');
        arrow.classList.remove('open');
      }

      function filterCities(type, searchTerm) {
        const items = document.getElementById(type + 'Items').children;
        
        for (let item of items) {
          const cityName = item.textContent.toLowerCase();
          const matches = cityName.includes(searchTerm.toLowerCase());
          item.style.display = matches ? 'block' : 'none';
        }
      }

      async function process(event) {
        event.preventDefault();
        
        if (!selectedStartCity || !selectedFinishCity) {
          alert('Please select both start and finish cities');
          return;
        }
        
        if (selectedStartCity === selectedFinishCity) {
          alert('Start and finish cities cannot be the same');
          return;
        }
        
        try {
          // Simulate API call
          // const res = await fetch('/api/process', {
          //   method: 'POST',
          //   headers: { 'Content-Type': 'application/json' },
          //   body: JSON.stringify({ start: selectedStartCity, finish: selectedFinishCity })
          // });
          // const data = await res.json();
          
          // Simulate response for demo
          const data = {
            shortest_path_length: Math.floor(Math.random() * 200) + 50,
            shortest_path_length_car: Math.floor(Math.random() * 180) + 60,
            shortest_path_length_train: Math.floor(Math.random() * 220) + 40,
            route_path: `${selectedStartCity} → ${selectedFinishCity}`
          };
          
          document.getElementById('motorcycle').innerText = `${data.shortest_path_length} KM`;
          document.getElementById('car').innerText = `${data.shortest_path_length_car} KM`;
          document.getElementById('train').innerText = `${data.shortest_path_length_train} KM`;
          document.getElementById('route_path').innerText = `Route: ${data.route_path}`;
        } catch (error) {
          console.error('Error:', error);
          alert('Error processing request. Please try again.');
        }
      }

      function showModal() {
        document.querySelector('.overlay').classList.add('active');
        document.querySelector('.modal-box').classList.add('active');
      }

      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        const dropdowns = document.querySelectorAll('.custom-dropdown');
        dropdowns.forEach(dropdown => {
          if (!dropdown.contains(event.target)) {
            const dropdownList = dropdown.querySelector('.dropdown-list');
            const arrow = dropdown.querySelector('.dropdown-arrow');
            dropdownList.classList.remove('show');
            arrow.classList.remove('open');
          }
        });
      });

      // Modal event listeners
      document.querySelector('.close-btn').addEventListener('click', () => {
        document.querySelector('.overlay').classList.remove('active');
        document.querySelector('.modal-box').classList.remove('active');
      });

      document.querySelector('.overlay').addEventListener('click', () => {
        document.querySelector('.overlay').classList.remove('active');
        document.querySelector('.modal-box').classList.remove('active');
      });

      // Initialize dropdowns when page loads
      document.addEventListener('DOMContentLoaded', function() {
        populateDropdowns();
      });
    </script>
  </body>
</html>